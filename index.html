<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.7/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>

    <style>
      body {margin:0; overflow:hidden; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
      .video-controls {position:fixed; bottom:20px; left:50%; transform:translateX(-50%); display:flex; gap:12px; z-index:1000; flex-wrap:wrap; justify-content:center;}
      .video-btn {background:linear-gradient(135deg,#b3b3b3 0%,#858585 100%); color:white; border:none; padding:12px 25px; border-radius:50px; font-size:14px; font-weight:600; cursor:pointer; text-transform:uppercase; letter-spacing:1px;}
      .video-btn.active {background:linear-gradient(135deg,#a5a5a5 0%,#797979 100%);}
      .info-btn {position:fixed; top:15px; right:15px; background:rgba(255,255,255,0.95); color:#333; border:none; padding:10px 16px; border-radius:50px; font-size:14px; font-weight:600; cursor:pointer; z-index:1000;}
      .video-indicator {position:fixed; top:15px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); color:white; padding:8px 20px; border-radius:50px; font-size:14px; z-index:999; backdrop-filter:blur(10px);}
      #infoModal {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:2000; overflow-y:auto;}
      #infoModalContent {background:white; padding:20px; width:90%; max-width:400px; max-height:80vh; overflow-y:auto; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.3); font-size:16px;}
      #infoModalContent h2 {font-size:18px; margin-top:15px;}
      #closeInfo {display:block; margin-top:15px; padding:10px 15px; border:none; background:#667eea; color:white; border-radius:8px; cursor:pointer; font-weight:600;}
      #infoModalContent video {width:100%; height:auto; border-radius:8px;}
    </style>
  </head>

  <body>
    <button class="info-btn" id="infoBtn">INFO</button>
    <div class="video-indicator" id="videoIndicator">Témoignage 1 : AXEL</div>

    <div class="video-controls">
      <button class="video-btn active" data-video="1">AXEL</button>
      <button class="video-btn" data-video="2">HÉLÈNE</button>
      <button class="video-btn" data-video="3">QUENTIN</button>
    </div>

    <a-scene 
      id="arScene"
      mindar-image="imageTargetSrc: ./assets/targets-JPO.mind; filterMinCF:10000000; filterBeta:1000; warmupTolerance:0; missTolerance:500;" 
      color-space="sRGB"
      renderer="colorManagement:true,physicallyCorrectLights,antialias:true"
      vr-mode-ui="enabled:false">

      <a-assets>
        <video id="video1" src="./assets/films/Temoin1extra.mp4" preload="auto" playsinline webkit-playsinline autoplay crossorigin="anonymous"></video>
        <video id="video2" src="./assets/films/Temoin2extra.mp4" preload="auto" playsinline webkit-playsinline autoplay crossorigin="anonymous"></video>
        <video id="video3" src="./assets/films/Temoin3extra.mp4" preload="auto" playsinline webkit-playsinline autoplay crossorigin="anonymous"></video>
        <img id="logo" src="./assets/object/Logo-simplifie-NB.jpg" />
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

      <a-entity mindar-image-target="targetIndex:0">
        <a-plane id="logo-simplified" src="#logo" position="-0.36446 0.45983 0.18071" height="0.15" width="0.25" rotation="0 0 0" material="blending:normal"></a-plane>
        <a-plane id="videoPlane" src="#video1" position="0 0 0" height="1.2" width="1" material="shader:flat"></a-plane>
      </a-entity>
    </a-scene>

    <!-- Modal INFO -->
    <div id="infoModal">
      <div id="infoModalContent">
        <h2>Informations</h2>
        <p>Cette expérience de réalité augmentée présente des témoignages d'anciens élèves des classes préparatoires aux grandes écoles (CPGE) du Lycée Louis de Cormontaigne de Metz. En pointant votre appareil vers le flyer, vous pouvez visionner les vidéos de AXEL, HÉLÈNE et QUENTIN, qui partagent leurs expériences et conseils.</p>
        <p>Ce projet a été imaginé, encadré et co-développé par Matthieu Farcot, avec deux stagiaires de première professionnelle CIEL du Lycée Louis de Cormontaigne, Alexis Paglierusco et Lucas Munsch.</p>
        <p>(c) 2025, Lycée Louis de Cormontaigne Metz</p>
        <a href="https://cpge.lycee-cormontaigne-metz.fr" target="_blank">Visitez notre site pour en savoir plus</a>

        <h2>Bonus</h2>
        <video controls playsinline webkit-playsinline>
          <source src="./assets/films/Chat.mp4" type="video/mp4">
          Votre navigateur ne supporte pas la vidéo.
        </video>

        <button id="closeInfo">Fermer</button>
      </div>
    </div>

    <script>
      const videoPlane = document.querySelector('#videoPlane');
      const videos = {1:document.querySelector('#video1'),2:document.querySelector('#video2'),3:document.querySelector('#video3')};
      const names = {1:"AXEL",2:"HÉLÈNE",3:"QUENTIN"};
      const buttons = document.querySelectorAll('.video-btn');
      const indicator = document.querySelector('#videoIndicator');
      let currentVideo = videos[1];
      let isTargetFound = false;

      // Boutons AR
      buttons.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const v = btn.getAttribute('data-video');
          currentVideo.pause(); currentVideo.currentTime=0;
          currentVideo = videos[v];
          videoPlane.setAttribute('src', `#video${v}`);
          if(isTargetFound) currentVideo.play().catch(()=>{});
          buttons.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          indicator.textContent=`Témoignage ${v} : ${names[v]}`;
        });
      });

      // AR target
      const sceneEl = document.querySelector('#arScene');
      sceneEl.addEventListener('renderstart', ()=>{
        const target = document.querySelector('[mindar-image-target]');
        target.addEventListener('targetFound', ()=>{
          isTargetFound=true;
          currentVideo.play().catch(()=>{});
        });
        target.addEventListener('targetLost', ()=>{
          isTargetFound=false;
          currentVideo.pause();
        });
      });

      // Modal INFO
      const infoBtn=document.getElementById('infoBtn');
      const infoModal=document.getElementById('infoModal');
      const closeInfo=document.getElementById('closeInfo');
      infoBtn.addEventListener('click', ()=>infoModal.style.display='flex');
      closeInfo.addEventListener('click', ()=>infoModal.style.display='none');
      infoModal.addEventListener('click', e=>{if(e.target===infoModal) infoModal.style.display='none';});
    </script>
  </body>
</html>
